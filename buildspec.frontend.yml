version: 0.2

phases:
  install:
    commands:
      - echo "Installing frontend dependencies..."
      - cd client
      - npm install
  build:
    commands:
      - echo "Building React frontend..."
      - npm run build
      - cd ..
      - echo "Preparing Dockerized frontend deployment package..."
      # create bundle folder
      - mkdir -p bundle
      # copy Dockerfile and configs from client/
      - cp client/Dockerfile bundle/
      - cp client/default.conf bundle/
      - cp client/env.sh bundle/
      # copy build output
      - cp -r client/build bundle/build
      # zip bundle folder contents for EB
      - cd bundle
      - zip -r ../frontend.zip .
artifacts:
  files:
    - frontend.zip
